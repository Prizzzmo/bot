
# Исторический образовательный бот для Telegram

Этот проект представляет собой интерактивного образовательного бота для Telegram, специализирующегося на истории России. Бот предлагает пользователям структурированное изучение исторических тем, интерактивное тестирование знаний, визуализацию исторических событий на картах и ведение тематических бесед.

## Содержание

1. [Обзор проекта](#обзор-проекта)
2. [Ключевые возможности](#ключевые-возможности)
3. [Архитектура решения](#архитектура-решения)
4. [Технологии и компоненты](#технологии-и-компоненты)
5. [Установка и настройка](#установка-и-настройка)
6. [API интеграции](#api-интеграции)
7. [Тестирование](#тестирование)
8. [Руководство по расширению](#руководство-по-расширению)
9. [Безопасность](#безопасность)
10. [Перспективы развития](#перспективы-развития)

## Обзор проекта

Образовательный бот по истории России представляет собой интерактивную платформу, объединяющую возможности Telegram-бота и веб-приложения. Проект обеспечивает структурированный доступ к историческим знаниям, интерактивным тестам и визуализациям исторических событий.

Бот разработан с использованием модульной архитектуры, что обеспечивает высокую расширяемость и поддерживаемость. Интеграция с Google Gemini API позволяет генерировать качественные образовательные материалы и проводить интеллектуальные беседы на исторические темы.

## Ключевые возможности

### 1. Изучение тем по истории России
- **Структурированный выбор тем**: Предоставление готовых тем по ключевым периодам и событиям российской истории
- **Пользовательские темы**: Возможность запроса информации по темам, введенным пользователем
- **Глубокий анализ материала**: Каждая тема представлена в 5 логических разделах с акцентом на разные аспекты

### 2. Интерактивное тестирование
- **Динамическая генерация тестов**: Уникальные тесты для каждой темы
- **Проверка и оценка знаний**: Автоматическая проверка ответов с подробными пояснениями
- **Персонализированная обратная связь**: Рекомендации по дальнейшему изучению

### 3. Исторические карты и визуализации
- **Интерактивные карты**: Отображение исторических событий на картах
- **Временные линии**: Визуализация хронологии исторических периодов
- **Веб-интерфейс**: Специальное веб-приложение для работы с картами

### 4. Аналитическая система
- **Отслеживание прогресса**: Статистика изучения тем и результатов тестов
- **Персонализированные рекомендации**: Предложения по дальнейшему обучению
- **Анализ активности пользователей**: Сбор данных для улучшения контента

### 5. Административный интерфейс
- **Веб-панель управления**: Мониторинг работы бота и просмотр статистики
- **Система логов**: Фильтрация и анализ событий
- **Управление контентом**: Возможность корректировки материалов

## Архитектура решения

Проект реализован на основе модульной архитектуры с четким разделением ответственности:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Telegram API   │◄───►│    Bot Core     │◄───►│   Gemini API    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                               ▲
                               │
                 ┌─────────────┴─────────────┐
                 │                           │
        ┌────────▼────────┐        ┌────────▼────────┐
        │  CommandHandlers │        │  ContentService │
        └─────────────────┘        └─────────────────┘
                 ▲                           ▲
                 │                           │
      ┌──────────┴──────────┐     ┌─────────┴─────────┐
      │                     │     │                   │
┌─────▼─────┐         ┌────▼────┐ │ ┌───────────┐    │
│UIManager  │         │APIClient │ │ │APICache   │    │
└───────────┘         └─────────┘ │ └───────────┘    │
      ▲                    ▲      │       ▲          │
      │                    │      │       │          │
      └────────┬───────────┘      └────┬──┘          │
               │                       │             │
        ┌──────▼──────┐         ┌─────▼─────┐┌────────▼────────┐
        │MessageManager│         │TextCache  ││AnalyticsService│
        └─────────────┘         └───────────┘└─────────────────┘
               ▲                                     ▲
               │                                     │
        ┌──────▼──────┐                     ┌────────▼────────┐
        │Logger       │                     │HistoryMapService│
        └─────────────┘                     └─────────────────┘
```

## Технологии и компоненты

Система состоит из следующих ключевых компонентов:

1. **Bot Core** (`src/bot.py`) - Основной компонент, отвечающий за взаимодействие с Telegram API
2. **API Client** (`src/api_client.py`) - Клиент для взаимодействия с Gemini API
3. **Content Service** (`src/content_service.py`) - Сервис для работы с историческими темами
4. **Topic Service** (`src/topic_service.py`) - Сервис для структурирования исторических тем 
5. **Conversation Service** (`src/conversation_service.py`) - Сервис для ведения бесед
6. **UI Manager** (`src/ui_manager.py`) - Компонент для управления пользовательским интерфейсом
7. **History Map Service** (`src/history_map.py`) - Сервис для работы с историческими картами
8. **Analytics Service** (`src/analytics.py`) - Сервис для сбора и анализа статистики
9. **Web Server** (`webapp/server.py`) - Веб-сервер для интерактивных карт и административного интерфейса

### Базовые технологии:
- **Python 3.9+**: Основной язык программирования
- **Telegram Bot API**: Взаимодействие с мессенджером Telegram
- **Google Gemini API**: Генерация контента и обработка запросов
- **Flask**: Веб-фреймворк для веб-приложения и административного интерфейса
- **Folium**: Библиотека для создания интерактивных карт

### Паттерны проектирования:
- **Модульная архитектура**: Разделение ответственности между компонентами
- **Factory**: Для создания и настройки компонентов
- **Service Locator**: Для централизованного управления сервисами
- **Dependency Injection**: Для управления зависимостями
- **Singleton**: Для объектов, которые должны существовать в единственном экземпляре

## Установка и настройка

### Требования

- Python 3.9+
- Telegram Bot Token
- Google Gemini API ключ

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта со следующим содержимым:

```
TELEGRAM_TOKEN=your_telegram_token_here
GEMINI_API_KEY=your_gemini_api_key_here
ADMIN_ID=your_telegram_id
```

### Запуск бота и веб-сервера

Для запуска только бота:
```bash
python main.py
```

Для запуска веб-сервера с картами:
```bash
python run_webapp.py
```

Для одновременного запуска бота и веб-сервера:
```bash
python run_combined.py
```

## API интеграции

Бот интегрируется с Google Gemini API для генерации контента. Основные методы:
- Генерация информации о темах (`src/api_client.py::get_historical_info`)
- Создание тестов (`src/api_client.py::generate_historical_test`)
- Ответы на вопросы (`src/api_client.py::ask_grok`)

### Особенности работы с API:

1. **Контроль параметров генерации**:
   - Низкая температура (0.1-0.3) для фактологических ответов
   - Более высокая температура (0.7) для генерации творческих тестовых заданий
   - Динамический контроль длины ответа в зависимости от типа запроса

2. **Эффективные промпты**:
   - Структурирование запросов для получения нужного формата ответа
   - Использование системных промптов для настройки поведения модели
   - Двухэтапная проверка для сложных запросов

3. **Кэширование запросов**:
   - Сохранение результатов частых запросов в кэше
   - LRU-политика вытеснения для оптимизации памяти
   - Асинхронное сохранение кэша в файл

## Тестирование

Проект включает набор автоматических тестов в директории `tests/`. Для запуска тестов выполните:

```bash
python -m unittest discover tests
```

### Типы тестов:
- **Модульные тесты**: Для отдельных компонентов системы
- **Интеграционные тесты**: Для проверки взаимодействия компонентов
- **Функциональные тесты**: Для проверки пользовательских сценариев

## Руководство по расширению

### Добавление новой команды

1. Определите обработчик команды в `src/handlers.py`
2. Зарегистрируйте команду в методе `setup_bot` в `src/bot.py`
3. При необходимости добавьте новое состояние в `src/config.py`

### Создание нового сервиса

1. Создайте класс сервиса в директории `src/`
2. Реализуйте методы сервиса
3. Зарегистрируйте сервис в `src/factory.py`
4. Добавьте сервис в контейнер в `src/service_container.py`

### Расширение веб-интерфейса

1. Добавьте новые маршруты в `webapp/server.py`
2. Создайте необходимые шаблоны в директории `templates/`
3. При необходимости обновите JavaScript код в `webapp/app.js`

## Безопасность

### Защита данных:
- Минимальный сбор пользовательских данных
- Отсутствие хранения личной информации
- Очистка истории диалогов по истечении определенного времени

### Безопасность API:
- Хранение ключей API в переменных окружения
- Валидация запросов перед отправкой
- Лимитирование частоты запросов

### Защита от злоупотреблений:
- Проверка релевантности запросов на историческую тематику
- Фильтрация некорректных запросов
- Мониторинг аномальной активности

## Перспективы развития

1. **Расширение образовательных возможностей**:
   - Добавление аудио и видео материалов
   - Интерактивные исторические симуляции
   - Система формирования индивидуальных образовательных траекторий

2. **Технологические улучшения**:
   - Интеграция с более современными моделями AI
   - Расширение функциональности веб-интерфейса
   - Улучшенная система аналитики с рекомендациями

3. **Расширение аудитории**:
   - Мультиязычная поддержка
   - Адаптация для различных возрастных групп
   - Интеграция с образовательными учреждениями

---

*© 2025 Образовательный бот по истории России*
